{
  "title": "Account has insufficient Available Balance",
  "date": "2021-12-10T00:00:00.000Z",
  "tags": [
    "Trading Bot",
    "trouble shooting"
  ],
  "draft": false,
  "summary": "토이 프로젝트로 진행 중인 트레이딩 봇의 로그에 BCHUSD의 계약 수량을 계산하는데 계정에 사용 가능한 잔액이 부족해서 거래소로부터의 거래가 거절되었다는 에러 메시지가 남기 시작했습니다.",
  "body": {
    "raw": "\n# Account has insufficient Available Balance\n\n## 문제\n\n> Account has insufficient Available Balance, ... XBt required\n\n토이 프로젝트로 진행 중인 트레이딩 봇의 로그에 BCHUSD의 계약 수량을 계산하는데 계정에 사용 가능한 잔액이 부족해서 거래소로부터의 거래가 거절되었다는 에러 메시지가 남기 시작했습니다.\n\n## 원인\n\n처음 개발 당시 수량 계산에 `GET /api/v1/user/wallet?currency=XBt`의 API를 호출해서 지갑 잔고 데이터를 사용했는데 원치 않는 수량이 계산되어 낭패를 본 경험이 있습니다. 지갑 잔고는 입금액 - 출금액 + 실현 손익이고 매일 12:00 UTC마다 해당 시까지의 실현 손익을 의미합니다.\n\n> Your margin available for new positions. Available Balance = Margin Balance - Order Margin - Position Margin.\n\n지갑 잔고에 대한 설명이 있는 마진 용어 설명 페이지를 다시 살펴보니 새로운 포지션을 갖기 위해 필요한 사용 가능한 잔고는 마진 잔고에서 \"주문 마진\"과 \"포지션 마진\"을 빼야 되는데\n지갑 잔고로 잘못 계산하고 있다는 걸 알게 된 이후 `GET /api/v1/user/margin`의 availableMargin를 그대로 사용하고 있었습니다.\n\n* 포지션 마진: 오픈된 포지션에 대한 개시 증거금\n* 주문 마진: 주문 생성시 필요한 개시 증거금\n\n> 그렇다면 6개월 이상 문제없이 잘 돌아가던 봇의 수량 계산이 왜 갑자기 틀렸다고 하는 걸까요?\n\n매일 모니터링한 것은 아니지만 로그에 해당 에러 로그가 남기 시작한 것은 다른 거래소 지원을 고려하면서 레버리지를 교차에서 1배로 고정한 시점입니다. 레버리지를 교차로 해놓고도 오랜 시간 1배의 수량으로 매수를 했었으니 잔고가 아주 여유로웠을 겁니다. 그래서 애초에 잘못된 계산식이 교차 레버리지로 인해서 무마되고 있었던 것이고 1배로 변경하면서 완전히 잔고 내에서의 수량 계산으로 개선이 필요하게 된 것입니다.\n\n그동안 실제 가진 잔고를 초과한 금액에서 \"계약을 위한 기본 개시 증거금을 고려하지 않고 계약할 수량을 계산\"했기 때문에 잔고가 부족하다는 에러 메시지가 이제서야 발생된 것이라는 결론을 내렸습니다.\n\n## 조치사항\n\n다른 이슈로 한 종목만 매수하고 있는 상황이라서 신규로 진입할 때는 항상 오픈된 포지션은 없으니 포지션 마진은 아직 계산할 필요는 없습니다. 따라서 위험 한도 페이지의 \"기본 개시 증거금\"만 `initialMargin`이라는 변수로 추가하고 해당 값을 뺀 마진 잔고로 계약할 수량을 계산하도록 수정했습니다.\n\n## 참고 자료\n\n* [거래소 마진 용어 설명](https://www.bitmex.com/app/marginTermReference)\n* [거래소 위험 한도](https://www.bitmex.com/app/riskLimits)\n\n<Comment/>\n",
    "code": "var Component=(()=>{var h=Object.create;var c=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,f=Object.prototype.hasOwnProperty;var b=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports),x=(i,e)=>{for(var a in e)c(i,a,{get:e[a],enumerable:!0})},t=(i,e,a,l)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let r of p(e))!f.call(i,r)&&r!==a&&c(i,r,{get:()=>e[r],enumerable:!(l=u(e,r))||l.enumerable});return i};var g=(i,e,a)=>(a=i!=null?h(m(i)):{},t(e||!i||!i.__esModule?c(a,\"default\",{value:i,enumerable:!0}):a,i)),v=i=>t(c({},\"__esModule\",{value:!0}),i);var d=b((y,o)=>{o.exports=_jsx_runtime});var M={};x(M,{default:()=>_,frontmatter:()=>w});var n=g(d()),w={title:\"Account has insufficient Available Balance\",date:\"2021-12-10\",tags:[\"Trading Bot\",\"trouble shooting\"],draft:!1,summary:\"\\uD1A0\\uC774 \\uD504\\uB85C\\uC81D\\uD2B8\\uB85C \\uC9C4\\uD589 \\uC911\\uC778 \\uD2B8\\uB808\\uC774\\uB529 \\uBD07\\uC758 \\uB85C\\uADF8\\uC5D0 BCHUSD\\uC758 \\uACC4\\uC57D \\uC218\\uB7C9\\uC744 \\uACC4\\uC0B0\\uD558\\uB294\\uB370 \\uACC4\\uC815\\uC5D0 \\uC0AC\\uC6A9 \\uAC00\\uB2A5\\uD55C \\uC794\\uC561\\uC774 \\uBD80\\uC871\\uD574\\uC11C \\uAC70\\uB798\\uC18C\\uB85C\\uBD80\\uD130\\uC758 \\uAC70\\uB798\\uAC00 \\uAC70\\uC808\\uB418\\uC5C8\\uB2E4\\uB294 \\uC5D0\\uB7EC \\uBA54\\uC2DC\\uC9C0\\uAC00 \\uB0A8\\uAE30 \\uC2DC\\uC791\\uD588\\uC2B5\\uB2C8\\uB2E4.\"};function s(i){let e=Object.assign({h1:\"h1\",a:\"a\",span:\"span\",h2:\"h2\",blockquote:\"blockquote\",p:\"p\",code:\"code\",ul:\"ul\",li:\"li\"},i.components),{Comment:a}=e;return a||B(\"Comment\",!0,\"44:1-44:11\"),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.h1,{id:\"account-has-insufficient-available-balance\",children:[(0,n.jsx)(e.a,{href:\"#account-has-insufficient-available-balance\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Account has insufficient Available Balance\"]}),(0,n.jsxs)(e.h2,{id:\"\\uBB38\\uC81C\",children:[(0,n.jsx)(e.a,{href:\"#\\uBB38\\uC81C\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\uBB38\\uC81C\"]}),(0,n.jsx)(e.blockquote,{children:(0,n.jsx)(e.p,{children:\"Account has insufficient Available Balance, ... XBt required\"})}),(0,n.jsx)(e.p,{children:\"\\uD1A0\\uC774 \\uD504\\uB85C\\uC81D\\uD2B8\\uB85C \\uC9C4\\uD589 \\uC911\\uC778 \\uD2B8\\uB808\\uC774\\uB529 \\uBD07\\uC758 \\uB85C\\uADF8\\uC5D0 BCHUSD\\uC758 \\uACC4\\uC57D \\uC218\\uB7C9\\uC744 \\uACC4\\uC0B0\\uD558\\uB294\\uB370 \\uACC4\\uC815\\uC5D0 \\uC0AC\\uC6A9 \\uAC00\\uB2A5\\uD55C \\uC794\\uC561\\uC774 \\uBD80\\uC871\\uD574\\uC11C \\uAC70\\uB798\\uC18C\\uB85C\\uBD80\\uD130\\uC758 \\uAC70\\uB798\\uAC00 \\uAC70\\uC808\\uB418\\uC5C8\\uB2E4\\uB294 \\uC5D0\\uB7EC \\uBA54\\uC2DC\\uC9C0\\uAC00 \\uB0A8\\uAE30 \\uC2DC\\uC791\\uD588\\uC2B5\\uB2C8\\uB2E4.\"}),(0,n.jsxs)(e.h2,{id:\"\\uC6D0\\uC778\",children:[(0,n.jsx)(e.a,{href:\"#\\uC6D0\\uC778\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\uC6D0\\uC778\"]}),(0,n.jsxs)(e.p,{children:[\"\\uCC98\\uC74C \\uAC1C\\uBC1C \\uB2F9\\uC2DC \\uC218\\uB7C9 \\uACC4\\uC0B0\\uC5D0 \",(0,n.jsx)(e.code,{children:\"GET /api/v1/user/wallet?currency=XBt\"}),\"\\uC758 API\\uB97C \\uD638\\uCD9C\\uD574\\uC11C \\uC9C0\\uAC11 \\uC794\\uACE0 \\uB370\\uC774\\uD130\\uB97C \\uC0AC\\uC6A9\\uD588\\uB294\\uB370 \\uC6D0\\uCE58 \\uC54A\\uB294 \\uC218\\uB7C9\\uC774 \\uACC4\\uC0B0\\uB418\\uC5B4 \\uB0AD\\uD328\\uB97C \\uBCF8 \\uACBD\\uD5D8\\uC774 \\uC788\\uC2B5\\uB2C8\\uB2E4. \\uC9C0\\uAC11 \\uC794\\uACE0\\uB294 \\uC785\\uAE08\\uC561 - \\uCD9C\\uAE08\\uC561 + \\uC2E4\\uD604 \\uC190\\uC775\\uC774\\uACE0 \\uB9E4\\uC77C 12:00 UTC\\uB9C8\\uB2E4 \\uD574\\uB2F9 \\uC2DC\\uAE4C\\uC9C0\\uC758 \\uC2E4\\uD604 \\uC190\\uC775\\uC744 \\uC758\\uBBF8\\uD569\\uB2C8\\uB2E4.\"]}),(0,n.jsx)(e.blockquote,{children:(0,n.jsx)(e.p,{children:\"Your margin available for new positions. Available Balance = Margin Balance - Order Margin - Position Margin.\"})}),(0,n.jsxs)(e.p,{children:['\\uC9C0\\uAC11 \\uC794\\uACE0\\uC5D0 \\uB300\\uD55C \\uC124\\uBA85\\uC774 \\uC788\\uB294 \\uB9C8\\uC9C4 \\uC6A9\\uC5B4 \\uC124\\uBA85 \\uD398\\uC774\\uC9C0\\uB97C \\uB2E4\\uC2DC \\uC0B4\\uD3B4\\uBCF4\\uB2C8 \\uC0C8\\uB85C\\uC6B4 \\uD3EC\\uC9C0\\uC158\\uC744 \\uAC16\\uAE30 \\uC704\\uD574 \\uD544\\uC694\\uD55C \\uC0AC\\uC6A9 \\uAC00\\uB2A5\\uD55C \\uC794\\uACE0\\uB294 \\uB9C8\\uC9C4 \\uC794\\uACE0\\uC5D0\\uC11C \"\\uC8FC\\uBB38 \\uB9C8\\uC9C4\"\\uACFC \"\\uD3EC\\uC9C0\\uC158 \\uB9C8\\uC9C4\"\\uC744 \\uBE7C\\uC57C \\uB418\\uB294\\uB370 \\uC9C0\\uAC11 \\uC794\\uACE0\\uB85C \\uC798\\uBABB \\uACC4\\uC0B0\\uD558\\uACE0 \\uC788\\uB2E4\\uB294 \\uAC78 \\uC54C\\uAC8C \\uB41C \\uC774\\uD6C4 ',(0,n.jsx)(e.code,{children:\"GET /api/v1/user/margin\"}),\"\\uC758 availableMargin\\uB97C \\uADF8\\uB300\\uB85C \\uC0AC\\uC6A9\\uD558\\uACE0 \\uC788\\uC5C8\\uC2B5\\uB2C8\\uB2E4.\"]}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"\\uD3EC\\uC9C0\\uC158 \\uB9C8\\uC9C4: \\uC624\\uD508\\uB41C \\uD3EC\\uC9C0\\uC158\\uC5D0 \\uB300\\uD55C \\uAC1C\\uC2DC \\uC99D\\uAC70\\uAE08\"}),(0,n.jsx)(e.li,{children:\"\\uC8FC\\uBB38 \\uB9C8\\uC9C4: \\uC8FC\\uBB38 \\uC0DD\\uC131\\uC2DC \\uD544\\uC694\\uD55C \\uAC1C\\uC2DC \\uC99D\\uAC70\\uAE08\"})]}),(0,n.jsx)(e.blockquote,{children:(0,n.jsx)(e.p,{children:\"\\uADF8\\uB807\\uB2E4\\uBA74 6\\uAC1C\\uC6D4 \\uC774\\uC0C1 \\uBB38\\uC81C\\uC5C6\\uC774 \\uC798 \\uB3CC\\uC544\\uAC00\\uB358 \\uBD07\\uC758 \\uC218\\uB7C9 \\uACC4\\uC0B0\\uC774 \\uC65C \\uAC11\\uC790\\uAE30 \\uD2C0\\uB838\\uB2E4\\uACE0 \\uD558\\uB294 \\uAC78\\uAE4C\\uC694?\"})}),(0,n.jsx)(e.p,{children:\"\\uB9E4\\uC77C \\uBAA8\\uB2C8\\uD130\\uB9C1\\uD55C \\uAC83\\uC740 \\uC544\\uB2C8\\uC9C0\\uB9CC \\uB85C\\uADF8\\uC5D0 \\uD574\\uB2F9 \\uC5D0\\uB7EC \\uB85C\\uADF8\\uAC00 \\uB0A8\\uAE30 \\uC2DC\\uC791\\uD55C \\uAC83\\uC740 \\uB2E4\\uB978 \\uAC70\\uB798\\uC18C \\uC9C0\\uC6D0\\uC744 \\uACE0\\uB824\\uD558\\uBA74\\uC11C \\uB808\\uBC84\\uB9AC\\uC9C0\\uB97C \\uAD50\\uCC28\\uC5D0\\uC11C 1\\uBC30\\uB85C \\uACE0\\uC815\\uD55C \\uC2DC\\uC810\\uC785\\uB2C8\\uB2E4. \\uB808\\uBC84\\uB9AC\\uC9C0\\uB97C \\uAD50\\uCC28\\uB85C \\uD574\\uB193\\uACE0\\uB3C4 \\uC624\\uB79C \\uC2DC\\uAC04 1\\uBC30\\uC758 \\uC218\\uB7C9\\uC73C\\uB85C \\uB9E4\\uC218\\uB97C \\uD588\\uC5C8\\uC73C\\uB2C8 \\uC794\\uACE0\\uAC00 \\uC544\\uC8FC \\uC5EC\\uC720\\uB85C\\uC6E0\\uC744 \\uAC81\\uB2C8\\uB2E4. \\uADF8\\uB798\\uC11C \\uC560\\uCD08\\uC5D0 \\uC798\\uBABB\\uB41C \\uACC4\\uC0B0\\uC2DD\\uC774 \\uAD50\\uCC28 \\uB808\\uBC84\\uB9AC\\uC9C0\\uB85C \\uC778\\uD574\\uC11C \\uBB34\\uB9C8\\uB418\\uACE0 \\uC788\\uC5C8\\uB358 \\uAC83\\uC774\\uACE0 1\\uBC30\\uB85C \\uBCC0\\uACBD\\uD558\\uBA74\\uC11C \\uC644\\uC804\\uD788 \\uC794\\uACE0 \\uB0B4\\uC5D0\\uC11C\\uC758 \\uC218\\uB7C9 \\uACC4\\uC0B0\\uC73C\\uB85C \\uAC1C\\uC120\\uC774 \\uD544\\uC694\\uD558\\uAC8C \\uB41C \\uAC83\\uC785\\uB2C8\\uB2E4.\"}),(0,n.jsx)(e.p,{children:'\\uADF8\\uB3D9\\uC548 \\uC2E4\\uC81C \\uAC00\\uC9C4 \\uC794\\uACE0\\uB97C \\uCD08\\uACFC\\uD55C \\uAE08\\uC561\\uC5D0\\uC11C \"\\uACC4\\uC57D\\uC744 \\uC704\\uD55C \\uAE30\\uBCF8 \\uAC1C\\uC2DC \\uC99D\\uAC70\\uAE08\\uC744 \\uACE0\\uB824\\uD558\\uC9C0 \\uC54A\\uACE0 \\uACC4\\uC57D\\uD560 \\uC218\\uB7C9\\uC744 \\uACC4\\uC0B0\"\\uD588\\uAE30 \\uB54C\\uBB38\\uC5D0 \\uC794\\uACE0\\uAC00 \\uBD80\\uC871\\uD558\\uB2E4\\uB294 \\uC5D0\\uB7EC \\uBA54\\uC2DC\\uC9C0\\uAC00 \\uC774\\uC81C\\uC11C\\uC57C \\uBC1C\\uC0DD\\uB41C \\uAC83\\uC774\\uB77C\\uB294 \\uACB0\\uB860\\uC744 \\uB0B4\\uB838\\uC2B5\\uB2C8\\uB2E4.'}),(0,n.jsxs)(e.h2,{id:\"\\uC870\\uCE58\\uC0AC\\uD56D\",children:[(0,n.jsx)(e.a,{href:\"#\\uC870\\uCE58\\uC0AC\\uD56D\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\uC870\\uCE58\\uC0AC\\uD56D\"]}),(0,n.jsxs)(e.p,{children:['\\uB2E4\\uB978 \\uC774\\uC288\\uB85C \\uD55C \\uC885\\uBAA9\\uB9CC \\uB9E4\\uC218\\uD558\\uACE0 \\uC788\\uB294 \\uC0C1\\uD669\\uC774\\uB77C\\uC11C \\uC2E0\\uADDC\\uB85C \\uC9C4\\uC785\\uD560 \\uB54C\\uB294 \\uD56D\\uC0C1 \\uC624\\uD508\\uB41C \\uD3EC\\uC9C0\\uC158\\uC740 \\uC5C6\\uC73C\\uB2C8 \\uD3EC\\uC9C0\\uC158 \\uB9C8\\uC9C4\\uC740 \\uC544\\uC9C1 \\uACC4\\uC0B0\\uD560 \\uD544\\uC694\\uB294 \\uC5C6\\uC2B5\\uB2C8\\uB2E4. \\uB530\\uB77C\\uC11C \\uC704\\uD5D8 \\uD55C\\uB3C4 \\uD398\\uC774\\uC9C0\\uC758 \"\\uAE30\\uBCF8 \\uAC1C\\uC2DC \\uC99D\\uAC70\\uAE08\"\\uB9CC ',(0,n.jsx)(e.code,{children:\"initialMargin\"}),\"\\uC774\\uB77C\\uB294 \\uBCC0\\uC218\\uB85C \\uCD94\\uAC00\\uD558\\uACE0 \\uD574\\uB2F9 \\uAC12\\uC744 \\uBE80 \\uB9C8\\uC9C4 \\uC794\\uACE0\\uB85C \\uACC4\\uC57D\\uD560 \\uC218\\uB7C9\\uC744 \\uACC4\\uC0B0\\uD558\\uB3C4\\uB85D \\uC218\\uC815\\uD588\\uC2B5\\uB2C8\\uB2E4.\"]}),(0,n.jsxs)(e.h2,{id:\"\\uCC38\\uACE0-\\uC790\\uB8CC\",children:[(0,n.jsx)(e.a,{href:\"#\\uCC38\\uACE0-\\uC790\\uB8CC\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\uCC38\\uACE0 \\uC790\\uB8CC\"]}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://www.bitmex.com/app/marginTermReference\",children:\"\\uAC70\\uB798\\uC18C \\uB9C8\\uC9C4 \\uC6A9\\uC5B4 \\uC124\\uBA85\"})}),(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://www.bitmex.com/app/riskLimits\",children:\"\\uAC70\\uB798\\uC18C \\uC704\\uD5D8 \\uD55C\\uB3C4\"})})]}),(0,n.jsx)(a,{})]})}function k(i={}){let{wrapper:e}=i.components||{};return e?(0,n.jsx)(e,Object.assign({},i,{children:(0,n.jsx)(s,i)})):s(i)}var _=k;function B(i,e,a){throw new Error(\"Expected \"+(e?\"component\":\"object\")+\" `\"+i+\"` to be defined: you likely forgot to import, pass, or provide it.\"+(a?\"\\nIt\\u2019s referenced in your code at `\"+a+\"` in `/Users/mzc02-swlee/dev/repository/seungwoo321.vercel.app/_mdx_bundler_entry_point-ece5f052-bfdb-41c0-9375-e7482206acab.mdx`\":\"\"))}return v(M);})();\n;return Component;"
  },
  "_id": "blog/nested-route/2021/12/10/error-report-account-has-insufficient-available-balance.mdx",
  "_raw": {
    "sourceFilePath": "blog/nested-route/2021/12/10/error-report-account-has-insufficient-available-balance.mdx",
    "sourceFileName": "error-report-account-has-insufficient-available-balance.mdx",
    "sourceFileDir": "blog/nested-route/2021/12/10",
    "contentType": "mdx",
    "flattenedPath": "blog/nested-route/2021/12/10/error-report-account-has-insufficient-available-balance"
  },
  "type": "Blog",
  "readingTime": {
    "text": "4 min read",
    "minutes": 3.95,
    "time": 237000,
    "words": 790
  },
  "slug": "nested-route/2021/12/10/error-report-account-has-insufficient-available-balance",
  "path": "blog/nested-route/2021/12/10/error-report-account-has-insufficient-available-balance",
  "filePath": "blog/nested-route/2021/12/10/error-report-account-has-insufficient-available-balance.mdx",
  "toc": [
    {
      "value": "Account has insufficient Available Balance",
      "url": "#account-has-insufficient-available-balance",
      "depth": 1
    },
    {
      "value": "문제",
      "url": "#문제",
      "depth": 2
    },
    {
      "value": "원인",
      "url": "#원인",
      "depth": 2
    },
    {
      "value": "조치사항",
      "url": "#조치사항",
      "depth": 2
    },
    {
      "value": "참고 자료",
      "url": "#참고-자료",
      "depth": 2
    }
  ]
}